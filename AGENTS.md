<INSTRUCTIONS>
## Область действия
Эти инструкции применяются ко всему репозиторию.

## Язык
- Всегда отвечай на русском.
- Документацию и комментарии в этом репозитории веди на русском.

## Цели проекта
- Лёгкое, детерминированное, событийное ядро карточного движка на TypeScript.
- Вес headless-ядра (только логика) — меньше 42KB gzipped.
- Чёткое разделение headless-ядра и UI-адаптеров (DOM/Canvas/CLI).

## Архитектурные ожидания
- Фиксированная базовая структура хода: draw → main → combat → end.
- Расширяемость через события, хуки и плагины.
- Карты как данные (JSON5), правила и движок — в TypeScript.
- Детерминированность: сидируемый RNG и упорядоченное разрешение по priority.
- Онлайн-режим: авторитетный сервер, клиент отправляет действия и получает состояние.

## Производительность
- 60 FPS для анимаций (UI слой).
- Разрешение хода < 20ms даже при сложных эффектах.
- Поддержка 1000+ карт без лагов.

## Принципы разработки
- Сначала headless, потом адаптеры представления.
- Стабильный, предсказуемый цикл и явная фаза разрешения эффектов.
- Минимум зависимостей, оптимизация критических путей.
- Лёгкая отладка: трассировка событий и эффектов при необходимости.
- Безопасность от бесконечных циклов в триггерах и эффектах.

## Ожидания по результату
- Юнит-тесты и базовая документация добавляются по мере разработки.
- Сохраняй разделение логики ядра и UI.
- Плагины и режимы должны подключаться через конфигурации.

## Журнал изменений (обязательно)
- После каждого изменения кода обновляй файл `CHANGELOG_SHORT.md`.
- Записывай кратко и без деталей, что было сделано.
</INSTRUCTIONS>
